
node(label:'slave1') {
    stage('clone')
    {
        git 'https://github.com/vinaysagar15/docker-kubernetes-hello-world.git'
    }
stage('build')
    {
        def mvnHome= tool name: 'maven', type: 'maven'
        sh "${mvnHome}/bin/mvn clean package" 
    }
   stage('Results') {
      junit '**/target/surefire-reports/TEST-*.xml'
      archiveArtifacts 'target/*.jar'
   }
stage('Building image') 
      {
      sh "docker build -t hello-world:hello ."
      }
stage('Docker Login')
      {
       sh "docker login -u vinaysagar15 -p Sagar=1997"
      }
stage('Docker Image Push')
      {
       sh "docker tag hello-world:hello vinaysagar15/helloworld:15 && docker push vinaysagar15/helloworld:15"
      }
      }
node(label:'slave1')
{
stage('Docker Image Pull')
      {
       sh "docker pull vinaysagar15/helloworld:15"
      }
stage('Run Image') 
       {
         sh "docker run -d --name sharan -p 8080:8080 vinaysagar15/helloworld:15"
       }
stage('Email Notification')
{
   try {
     notifyBuild('STARTED')
 
     /* ... existing build steps ... */
 
   } catch (e) {
     // If there was an exception thrown, the build failed
     currentBuild.result = "FAILED"
     throw e
   } finally {
     // Success or failure, always send notifications
     notifyBuild(currentBuild.result)
   }
 
 def notifyBuild(String buildStatus = 'STARTED') {
   // build status of null means successful
   buildStatus =  buildStatus ?: 'SUCCESSFUL'
 
   // Default values
   def colorName = 'RED'
   def colorCode = '#FF0000'
   def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
   def summary = "${subject} (${env.BUILD_URL})"
   def details = """<p>STARTED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':</p>
     <p>Check console output at "<a href="${env.BUILD_URL}">${env.JOB_NAME} [${env.BUILD_NUMBER}]</a>"</p>"""
 
   // Override default values based on build status
   if (buildStatus == 'STARTED') {
     color = 'YELLOW'
     colorCode = '#FFFF00'
   } else if (buildStatus == 'SUCCESSFUL') {
     color = 'GREEN'
     colorCode = '#00FF00'
   } else {
     color = 'RED'
     colorCode = '#FF0000'
   }
 
   // Send notifications
   slackSend (color: colorCode, message: summary)
 
   hipchatSend (color: color, notify: true, message: summary)
      emailext body: 'build fail', subject: 'error', to: 'sharan9434@gmail.com'
}
}
}
