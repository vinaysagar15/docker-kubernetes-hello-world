
node(label:'slave1') {
try
{
    stage('clone')
    {
        git 'https://github.com/vinaysagar15/docker-kubernetes-hello-world.git'
    }
   
stage('build')
    {
        def mvnHome= tool name: 'maven', type: 'maven'
        sh "${mvnHome}/bin/mvn clean package" 
    }
   stage('Results') {
      junit '**/target/surefire-reports/TEST-*.xml'
      archiveArtifacts 'target/*.jar'
   }
stage('Building image') 
      {
            sh "docker build -t hello-world:hello ."
      }
emailext body: '"Job '${JOB_NAME}' (${BUILD_NUMBER}) is waiting for input Please go to ${BUILD_URL} and verify the build ,   ', subject: 'Building image approval', to: 'ksvinay043@gmail.com'

stage('Docker Login')
      {
            sh "docker login -u vinaysagar15 -p Sagar=1997"
      }
stage('Docker Image Push')
      {
            sh "docker tag hello-world:hello vinaysagar15/helloworld:15 && docker push vinaysagar15/helloworld:15"
      }

stage('Docker Image Pull')
      {
            sh "docker pull vinaysagar15/helloworld:15"
      }
      emailext body: 'Your image is ready,need approval for deploying!  ', subject: 'Running image approval', to: 'ksvinay043@gmail.com'
      input message: 'Ready to Approve or not?', ok: 'Approve'
stage('Run Image') 
       {
            sh "docker run -d --name min -p 8080:8080 vinaysagar15/helloworld:15"
       }
       stage('Email Notification')
       {  
            echo 'BUILD SUCCESS'
            def currentResult = ${currentBuild.currentResult}
            def JOB_NAME = ${env.JOB_NAME}
            def BUILD_NUMBER = ${env.BUILD_NUMBER}
            def BUILD_URL = ${env.BUILD_URL}
            emailext body: '${currentBuild.currentResult}: Job ${env.JOB_NAME} build ${env.BUILD_NUMBER}\n More info at: ${env.BUILD_URL}', subject: 'Jenkins Build ${currentBuild.currentResult}: Job ${env.JOB_NAME}', to: 'ksvinay043@gmail.com'
       }
}
catch(e)
{
    stage('Email Notification')
    {
        echo 'BUILD FAILURE'
            def currentResult = ${currentBuild.currentResult}
            def JOB_NAME = ${env.JOB_NAME}
            def BUILD_NUMBER = ${env.BUILD_NUMBER}
            def BUILD_URL = ${env.BUILD_URL}
            emailext body: '${currentBuild.currentResult}: Job ${env.JOB_NAME} build ${env.BUILD_NUMBER}\n More info at: ${env.BUILD_URL}', subject: 'Jenkins Build ${currentBuild.currentResult}: Job ${env.JOB_NAME}', to: 'ksvinay043@gmail.com'
    }
 }
}




